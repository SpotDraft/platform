!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@angular/core"),require("@angular-redux/store"),require("immutable"),require("@angular/forms"),require("rxjs/operators")):"function"==typeof define&&define.amd?define("@angular-redux/form",["exports","@angular/core","@angular-redux/store","immutable","@angular/forms","rxjs/operators"],e):e((t["angular-redux"]=t["angular-redux"]||{},t["angular-redux"].form={}),t.ng.core,null,null,t.ng.forms,t.rxjs.operators)}(this,function(t,e,r,y,l,n){"use strict";var o="@@angular-redux/form/FORM_CHANGED",a=function(){function t(t){this.store=t}return t.prototype.getState=function(){return this.store.getState()},t.prototype.subscribe=function(t){var e=this;return this.store.subscribe(function(){return t(e.getState())})},t.prototype.valueChanged=function(t,e,r){this.store.dispatch({type:o,payload:{path:t,form:e,valid:!0===e.valid,value:r}})},t.decorators=[{type:e.Injectable}],t.ctorParameters=function(){return[{type:r.NgRedux}]},t}(),i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)};function u(t,e){function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}var s=function(){return(s=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)};function h(t){var e="function"==typeof Symbol&&t[Symbol.iterator],r=0;return e?e.call(t):{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}}}function c(t,e){var r="function"==typeof Symbol&&t[Symbol.iterator];if(!r)return t;var n,o,a=r.call(t),i=[];try{for(;(void 0===e||0<e--)&&!(n=a.next()).done;)i.push(n.value)}catch(u){o={error:u}}finally{try{n&&!n.done&&(r=a["return"])&&r.call(a)}finally{if(o)throw o.error}}return i}function f(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(c(arguments[e]));return t}var d=function(e){function t(t){return e.call(this,t)||this}return u(t,e),t}(Error),p=function(){function c(){}return c.traverse=function(t,e,r){var n,o,a=t;try{for(var i=h(e),u=i.next();!u.done;u=i.next()){var c=u.value,s=a;if(y.Iterable.isIterable(a)){var f=a;if("function"!=typeof f.get)throw new d("Cannot retrieve value from immutable nonassociative container: "+c);a=f.get(c)}else a=a instanceof Map?a.get(c):a[c];if("function"==typeof r){var l=r(s,c,e.slice(e.indexOf(c)+1),a);a=l[c],Object.assign(s,l)}if(a===undefined)return undefined}}catch(p){n={error:p}}finally{try{u&&!u.done&&(o=i["return"])&&o.call(i)}finally{if(n)throw n.error}}return a},c.get=function(t,e){return c.traverse(t,e)},c.assign=function(t,e,u){var r=c.inspect(t);if(0===e.length)return r.update(null,u);var n=r.clone();return c.traverse(n,e,function(t,e,r,n){var o=c.inspect(t);if(n){var a=c.inspect(n);return o.update(e,0<r.length?a.clone():a.merge(null,u))}var i;return o.update(e,0<r.length?"number"==typeof(i=r[0])?new Array:Array.isArray(i)?y.Map():new Object:u)}),n},c.inspect=function(e){var t=function(n,o,t){var a={clone:"function"==typeof t?function(){return t(e)}:function(){return e},update:function(t,e){return n(a.clone(),t,e)},merge:function(e,t){var r=a.clone();return o(r,e,t,function(t){return n(r,e,t)})}};return a};if(y.Iterable.isIterable(e))return t(function(t,e,r){return null!=e?t.set(e,r):r},function(t,e,r){return e?t.mergeDeepIn(Array.isArray(e)?e:[e],r):y.Map.isMap(r)?t.mergeDeep(r):t.concat(r)});if(Array.isArray(e))return t(function(t,e,r){null!=e?t[e]=r:t.splice.apply(t,[0,t.length].concat(Array.isArray(r)?r:[r]))},function(t,e,r,n){return n(t.concat(r)),t},function(){return Array.prototype.slice.call(e,0)});if(e instanceof Map)return t(function(r,t,e){if(null!=t)return r.set(t,e);var n=new Map(e);return r.clear(),n.forEach(function(t,e){return r.set(e,t)}),r},function(r,t,e){return new Map(e).forEach(function(t,e){return r.set(e,t)}),r},function(){return e instanceof WeakMap?new WeakMap(e):new Map(e)});if(e instanceof WeakSet||e instanceof Set)return t(function(r,t,e){if(null!=t)return r.set(t,e);var n=new Set(e);return n.forEach(function(t,e){return r.set(e,t)}),n.clear(),r},function(t,e,r){try{for(var n=h(r),o=n.next();!o.done;o=n.next()){var a=o.value;t.add(a)}}catch(c){i={error:c}}finally{try{o&&!o.done&&(u=n["return"])&&u.call(n)}finally{if(i)throw i.error}}return t;var i,u},function(){return e instanceof WeakSet?new WeakSet(e):new Set(e)});if(e instanceof Date)throw new d("Cannot understand why a Date object appears in the mutation path!");switch(typeof e){case"boolean":case"function":case"number":case"string":case"symbol":case"undefined":break;case"object":if(null==e)break;return t(function(t,e,r){return s({},t,null!=e?((n={})[e]=r,n):r);var n},function(t,e,r){try{for(var n=h(Object.keys(r)),o=n.next();!o.done;o=n.next()){var a=o.value;t[a]=r[a]}}catch(c){i={error:c}}finally{try{o&&!o.done&&(u=n["return"])&&u.call(n)}finally{if(i)throw i.error}}return t;var i,u},function(){return s({},e)})}throw new Error("An object of type "+typeof e+" has appeared in the mutation path! Every element in the mutation path should be an array, an associative container, or a set")},c.empty=function(t){return null==t||0===t.length||"undefined"==typeof t.length&&0===Object.keys(t).length},c}(),v=function(e){return{dispatch:function(t){return e.dispatch(t)},getState:function(){return e.getState()},subscribe:function(t){return e.subscribe(function(){return t(e.getState())})}}},m=function(){function t(){}return Object.defineProperty(t.prototype,"path",{get:function(){var t="function"==typeof this.connect?this.connect():this.connect;switch(typeof t){case"object":if(p.empty(t))return[];if(Array.isArray(t))return t;case"string":return t.split(/\./g);default:throw new Error("Cannot determine path to object: "+JSON.stringify(t))}},enumerable:!0,configurable:!0}),t.prototype.ngOnDestroy=function(){this.formSubscription&&this.formSubscription.unsubscribe(),"function"==typeof this.stateSubscription&&this.stateSubscription()},t.prototype.ngAfterContentInit=function(){var e=this;Promise.resolve().then(function(){e.resetState(),e.store&&(e.stateSubscription=e.store.subscribe(function(){return e.resetState()})),Promise.resolve().then(function(){e.formSubscription=e.form.valueChanges.pipe(n.debounceTime(0)).subscribe(function(t){return e.publish(t)})})})},t.prototype.descendants=function(c,t){var e,r,s=this,f=new Array;if(t instanceof l.FormArray)t.controls.forEach(function(t,e){try{for(var r=h(s.descendants(c.concat([e]),t)),n=r.next();!n.done;n=r.next()){var o=n.value;f.push(o)}}catch(u){a={error:u}}finally{try{n&&!n.done&&(i=r["return"])&&i.call(r)}finally{if(a)throw a.error}}var a,i});else{if(!(t instanceof l.FormGroup)){if(t instanceof l.NgControl||t instanceof l.FormControl)return[{path:c,control:t}];throw new Error("Unknown type of form element: "+t.constructor.name)}try{for(var n=h(Object.keys(t.controls)),o=n.next();!o.done;o=n.next()){var a=o.value;f.push({path:c.concat([a]),control:t.controls[a]})}}catch(i){e={error:i}}finally{try{o&&!o.done&&(r=n["return"])&&r.call(n)}finally{if(e)throw e.error}}}return f.filter(function(t){var e=t.control._parent;return e===s.form.control||e===s.form})},t.prototype.resetState=function(){var o=this,t=this.form.control===undefined?this.form:this.form.control;this.descendants([],t).forEach(function(t){var e=t.path,r=t.control,n=p.get(o.getState(),o.path.concat(e));r.value!==n&&r.setValue(n)})},t.prototype.publish=function(t){this.store&&this.store.valueChanged(this.path,this.form,t)},t.prototype.getState=function(){if(this.store)return this.store.getState()},t.propDecorators={connect:[{type:e.Input}]},t}(),g=function(r){function t(t){var e=r.call(this)||this;return e.store=t,e}return u(t,r),t.decorators=[{type:e.Directive,args:[{selector:"form[connect][formGroup]"}]}],t.ctorParameters=function(){return[{type:a}]},t.propDecorators={formGroup:[{type:e.Input}]},t}(m),b=function(n){function t(t,e){var r=n.call(this)||this;return r.store=t,r.form=e,r}return u(t,n),t.decorators=[{type:e.Directive,args:[{selector:"form[connect]:not([formGroup])"}]}],t.ctorParameters=function(){return[{type:a},{type:l.NgForm}]},t}(m),w=[b,g],S=function(){function t(){}return t.decorators=[{type:e.NgModule,args:[{declarations:f(w),exports:f(w)}]}],t}();var x=function D(t,e,r){this.$implicit=t,this.index=e,this.item=r},A=function(c){function t(t,e,r,n,o,a,i){var u=c.call(this)||this;return u.parent=t,u.rawValidators=e,u.rawAsyncValidators=r,u.connection=n,u.templateRef=o,u.viewContainerRef=a,u.store=i,u.array=new l.FormArray([]),u.stateSubscription=u.store.subscribe(function(t){return u.resetState(t)}),u.registerInternals(u.array),u}return u(t,c),Object.defineProperty(t.prototype,"connectArrayOf",{set:function(t){this.key=t,this.resetState(this.store.getState())},enumerable:!0,configurable:!0}),t.prototype.ngOnInit=function(){this.formDirective.addControl(this)},Object.defineProperty(t.prototype,"name",{get:function(){return this.key||""},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"control",{get:function(){return this.array},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"formDirective",{get:function(){return this.parent.formDirective},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"path",{get:function(){return this.key?function r(t,e){return f(e.path||[],[t])}(this.key,this.parent):[]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"validator",{get:function(){return l.Validators.compose(this.rawValidators)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"asyncValidator",{get:function(){return l.Validators.composeAsync(this.rawAsyncValidators)},enumerable:!0,configurable:!0}),t.prototype.updateValueAndValidity=function(){},t.prototype.ngOnDestroy=function(){this.viewContainerRef.clear(),this.key&&this.formDirective.form.removeControl(this.key),this.stateSubscription()},t.prototype.resetState=function(t){if(null!=this.key&&0!==this.key.length){var e,r,n=p.get(t,this.connection.path.concat(this.path)),o=0;try{for(var a=h(n),i=a.next();!i.done;i=a.next()){var u=i.value,c=this.viewContainerRef.length>o?this.viewContainerRef.get(o):null;if(null==c){var s=this.viewContainerRef.createEmbeddedView(this.templateRef,new x(o,o,u),o);this.patchDescendantControls(s),this.array.insert(o,this.transform(this.array,s.context.item))}else Object.assign(c.context,new x(o,o,u));++o}}catch(f){e={error:f}}finally{try{i&&!i.done&&(r=a["return"])&&r.call(a)}finally{if(e)throw e.error}}for(;this.viewContainerRef.length>o;)this.viewContainerRef.remove(this.viewContainerRef.length-1)}},t.prototype.registerInternals=function(t){t.registerControl=function(){return undefined},t.registerOnChange=function(){return undefined},Object.defineProperties(this,{_rawValidators:{value:this.rawValidators||[]},_rawAsyncValidators:{value:this.rawAsyncValidators||[]}})},t.prototype.patchDescendantControls=function(e){var r=this;Object.keys(e._view).map(function(t){return e._view[t]}).filter(function(t){return t instanceof l.NgModelGroup}).forEach(function(t){Object.defineProperties(t,{_parent:{value:r},_checkParentType:{value:function(){return undefined}}})})},t.prototype.transform=function(s,t){var f=this,e=function(){var t=new l.FormControl(null);return t.setParent(s),t};if(null==t)return e();switch("function"==typeof t.toJS&&(t=t.toJS()),typeof t){case"string":case"number":case"boolean":return e()}var r=function(t){var e,r,n=new l.FormArray([]);f.registerInternals(n);for(var o=n.length;0<o;o--)n.removeAt(o);try{for(var a=h(t),i=a.next();!i.done;i=a.next()){var u=i.value,c=f.transform(n,u);c&&n.push(c)}}catch(s){e={error:s}}finally{try{i&&!i.done&&(r=a["return"])&&r.call(a)}finally{if(e)throw e.error}}return n},n=function(t){var e,r,n=new l.FormGroup({});n.setParent(s);try{for(var o=h(Object.keys(t)),a=o.next();!a.done;a=o.next()){var i=a.value,u=f.transform(n,t[i]);u&&n.addControl(i,u)}}catch(c){e={error:c}}finally{try{a&&!a.done&&(r=o["return"])&&r.call(o)}finally{if(e)throw e.error}}return n};if(Array.isArray(t))return r(t);if(t instanceof Set)return r(t);if(t instanceof Map)return n(t);if(t instanceof Object)return n(t);throw new Error("Cannot convert object of type "+typeof t+" / "+t.toString()+" to form element")},t.decorators=[{type:e.Directive,args:[{selector:"[connectArray]",providers:[{provide:l.ControlContainer,useExisting:e.forwardRef(function(){return t})}]}]}],t.ctorParameters=function(){return[{type:l.ControlContainer,decorators:[{type:e.Optional},{type:e.Host},{type:e.SkipSelf}]},{type:Array,decorators:[{type:e.Optional},{type:e.Self},{type:e.Inject,args:[l.NG_VALIDATORS]}]},{type:Array,decorators:[{type:e.Optional},{type:e.Self},{type:e.Inject,args:[l.NG_ASYNC_VALIDATORS]}]},{type:m},{type:e.TemplateRef},{type:e.ViewContainerRef},{type:a}]},t.propDecorators={connectArrayOf:[{type:e.Input}]},t}(l.ControlContainer),C=[A],O=function(){function t(){}return t.decorators=[{type:e.NgModule,args:[{declarations:f(C),exports:f(C)}]}],t}();function j(t){return new a(t)}var R=function(){function t(){}return t.decorators=[{type:e.NgModule,args:[{imports:[l.FormsModule,l.ReactiveFormsModule,S,O],exports:[S,O],providers:[{provide:a,useFactory:j,deps:[r.NgRedux]}]}]}],t}();t.composeReducers=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return function(t,r){return e.reduce(function(t,e){return e(t,r)},t)}},t.defaultFormReducer=function(r){return function(t,e){switch(void 0===t&&(t=r),e.type){case o:return p.assign(t,e.payload.path,e.payload.value);default:return t}}},t.FormException=d,t.FORM_CHANGED=o,t.FormStore=a,t.provideReduxForms=function(t){var e=v(t);return[{provide:a,useValue:new a(e)}]},t.ConnectBase=m,t.ReactiveConnectDirective=g,t.NgReduxFormConnectModule=S,t.ConnectDirective=b,t.NgReduxFormConnectArrayModule=O,t.ConnectArrayDirective=A,t.ConnectArrayTemplate=x,t.formStoreFactory=j,t.NgReduxFormModule=R,t.ɵa=S,t.ɵb=O,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=angular-redux-form.umd.min.js.map